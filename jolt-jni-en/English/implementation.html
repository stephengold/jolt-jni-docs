<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How Jolt JNI works :: The Jolt-JNI project</title>
    <link rel="canonical" href="https://stephengold.github.io/jolt-jni/jolt-jni-en/English/implementation.html">
    <meta name="generator" content="Antora 3.1.12">
    <link rel="stylesheet" href="../../_/css/site.css">
<meta property="og:image" content="../../_/img/iconx128.png">
<meta property="og:description" content="How Jolt JNI works">
<meta property="og:title" content="The Jolt-JNI project">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stephengold.github.io/jolt-jni">
        <img alt="" src="../../_/img/iconx128.png" width="32" type="image/x-icon" style="margin-right:16px">
        The Jolt-JNI project
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Color themes</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" onclick="setTheme('canyon')">Canyon</a>
            <a class="navbar-item" onclick="setTheme('dark')">Dark</a>
            <a class="navbar-item" onclick="setTheme('jungle')">Jungle</a>
            <a class="navbar-item" onclick="setTheme('light')">Light</a>
            <a class="navbar-item" onclick="setTheme('pastel')">Pastel</a>
            <a class="navbar-item" onclick="setTheme('phosphor')">Phosphor<a>
            <a class="navbar-item" style="padding-top: 5px;padding-left: 1px;padding-right: 1px;"></button>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jolt-jni-en" data-version="English">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="overview.html">Project links</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Library tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add.html">Add to existing project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sport.html">Sport-Jolt visualization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rigidbody.html">Rigid bodies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="free.html">Freeing memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="debug.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="shape.html">Collision shapes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="constraint.html">Constraints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="character.html">Characters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vehicle.html">Vehicles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="collision.html">Managing collisions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="softbody.html">Soft bodies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serialization.html">Serialization</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="build.html">Build procedures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="demos.html">Demo apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lexicon.html">Type lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni">GitHub repository</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/releases/latest">Latest release</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/releases">Recent releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/README.md">ReadMe file</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/CONTRIBUTING.md">Contributor guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/LICENSE">License</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/release-log.md">Release log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/commits/master">Recent commits</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/issues">Issue tracker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/issues/new">Report an issue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Library APIs (javadoc)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://stephengold.github.io/jolt-jni-docs/javadoc/latest/com.github.stephengold.joltjni/com/github/stephengold/joltjni/package-summary.html">latest release</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jolt JNI at other sites</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://repo1.maven.org/maven2/com/github/stephengold">Maven Central download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://central.sonatype.com/search?q=jolt-jni&amp;namespace=com.github.stephengold">Maven Central search</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://jitpack.io/#stephengold/jolt-jni">JitPack (unofficial)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Projects using Jolt JNI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni-docs">jolt-jni-docs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/sport-jolt">Sport-Jolt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/kk-physics">KK Physics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other related projects</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://jrouwe.github.io/JoltPhysics">Jolt Physics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://stephengold.github.io/Libbulletjme">Libbulletjme</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/kmammou/v-hacd">V-HACD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/antora-ui-bundle">Website UI bundle</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">People</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://stephengold.github.io">Stephen Gold</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Jolt-JNI project</span>
    <span class="version">English</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Jolt-JNI project</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="overview.html">English</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle-label">Project links</span>
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="overview.html">The Jolt-JNI project</a></li>
    <li><a href="implementation.html">Implementation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stephengold/jolt-jni-docs/edit/master/docs/en/modules/ROOT/pages/implementation.adoc">Edit this page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">How Jolt JNI works</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>For physics simulation and collision detection,
Jolt JNI uses <a href="https://jrouwe.github.io/JoltPhysics">Jolt Physics</a>,
a modern, open-source, 3-D physics simulator,
released under <a href="https://github.com/jrouwe/JoltPhysics?tab=MIT-1-ov-file">an MIT license</a>.</p>
</div>
<div class="paragraph">
<p>To enable efficient simulation of complex moving shapes,
Jolt JNI also incorporates Khaled Mamou&#8217;s
<a href="https://github.com/kmammou/v-hacd">Volumetric-Hierarchical Approximate Convex Decomposition (V-HACD) algorithm</a>,
released under
<a href="https://github.com/kmammou/v-hacd/blob/master/LICENSE">a 3-Clause BSD License</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_libraries"><a class="anchor" href="#_native_libraries"></a>Native libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jolt Physics and V-HACD are written in C&#43;&#43;, so Jolt JNI uses
<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jni/index.html">the Java Native Interface (JNI)</a>
to access their objects and methods.</p>
</div>
<div class="paragraph">
<p>Before instantiating physics objects,
a Jolt-JNI app must <a href="https://en.wikipedia.org/wiki/Dynamic_loading">dynamically load</a>
a <em>native library</em> of this code,
compiled for the <a href="https://en.wikipedia.org/wiki/Computing_platform">platform</a>
on which the app is executing.</p>
</div>
<div class="paragraph">
<p>The Jolt-JNI project publishes native libraries
for 12 different platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows (x86-64 with and without AVX2),</p>
</li>
<li>
<p>Linux (x86-64 with and without FMA, armhf, and aarch64),</p>
</li>
<li>
<p>macOS (x86-64 and ARM64), and</p>
</li>
<li>
<p>Android (armeabi-v7a, arm64-v8a, x86, and x86_64).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
32-bit and 64-bit versions of the same operating system
count as distinct platforms!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For each platform, Jolt JNI builds 2 types of libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Debug" (for development, debugging, and functional testing) and</p>
</li>
<li>
<p>"Release" (for performance testing and production use).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, native libraries come in 2 <em>flavors</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Sp" (using
<a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">single-precision</a> locations) and</p>
</li>
<li>
<p>"Dp" (using
<a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">double-precision</a> locations).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these native libraries share a common API,
so a single JVM library suffices.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_read_only_interfaces"><a class="anchor" href="#_read_only_interfaces"></a>Read-only interfaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In C&#43;&#43;, member functions can be qualified with the <code>const</code> keyword,
to indicate they don&#8217;t significantly modify the current object.
The Java language lacks such a feature.</p>
</div>
<div class="paragraph">
<p>Jolt JNI mimics the <code>const</code> feature by declaring read-only interfaces
for important classes.
These interfaces are in the "com.github.stephengold.joltjni.readonly" package
and have names beginning with "Const" or ending with "Arg".</p>
</div>
<div class="paragraph">
<p>For instance, if the Jolt-Physics <code>CharacterVirtual</code> class declares a member function</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">bool HasCollidedWith (const Body &amp;inBody) const</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the corresponding method in Jolt JNI
should take a <code>ConstBody</code> argument (due to the first <code>const</code>) and
should be included in the <code>ConstCharacterVirtual</code> interface
(due to the second <code>const</code>).</p>
</div>
<div class="paragraph">
<p>C&#43;&#43; allows public fields and member data of a <code>const</code> object
to be read but not modified.
So if the Jolt-Physics <code>BarSettings</code> struct declares a public field <code>mFoo</code>,
then the <code>getFoo()</code> method
should be included in Jolt JNI&#8217;s <code>ConstBarSettings</code> interface,
but the <code>setFoo()</code> method should not.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bodies_physics_systems_and_shapes"><a class="anchor" href="#_bodies_physics_systems_and_shapes"></a>Bodies, physics systems, and shapes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Collision detection is organized around <em>bodies</em> and <em>constraints</em>
that interact in the context of a <em>physics system</em>.</p>
</div>
<div class="paragraph">
<p>Bodies can be <em>soft</em> (varying shape) or <em>rigid</em> (non-varying shape).
Rigid bodies can be <em>moving</em> or <em>static</em> (non-moving).
And moving bodies can be <em>dynamic</em> (driven by <a href="https://en.wikipedia.org/wiki/Force">forces</a>,
<a href="https://en.wikipedia.org/wiki/Torque">torques</a>, and <a href="https://en.wikipedia.org/wiki/Impulse_(physics)">impulses</a>)
or <em>kinematic</em> (driven directly by external calculations).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bodies (<code>Body</code> class)</p>
<div class="ulist">
<ul>
<li>
<p>soft bodies</p>
</li>
<li>
<p>rigid bodies</p>
<div class="ulist">
<ul>
<li>
<p>moving</p>
<div class="ulist">
<ul>
<li>
<p>dynamic</p>
</li>
<li>
<p>kinematic</p>
</li>
</ul>
</div>
</li>
<li>
<p>static</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>constraints (<code>Constraint</code> abstract class)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each rigid body references a <em>collision shape</em>
that describes the shape of its surface.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coordinate_systems_and_units"><a class="anchor" href="#_coordinate_systems_and_units"></a>Coordinate systems and units</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A body&#8217;s absolute location and orientation are quantified
in <em>system coordinates</em> (also known as <em>world space</em>),
a right-handed Cartesian coordinate system.</p>
</div>
<div class="paragraph">
<p>Dimensions and distances are nominally in meters.
Simulation is most accurate for dynamic objects
between 0.1 and 10 meters in size,
with speeds under 500 meters per second.
Static object should be 0.1 to 2,000 meters in size.
To simulate outside these ranges, scale dimensions and distances accordingly.</p>
</div>
<div class="paragraph">
<p>In the JVM library, double-precision floating point is always used
to represent locations in system coordinates.
If all simulation takes place within roughly 5,000 meters of the origin,
single-precision native libraries provide sufficient accuracy.
For larger worlds, use double-precision native libraries.</p>
</div>
<div class="paragraph">
<p>Jolt JNI doesn&#8217;t require a particular "up" direction.
However, the "up" directions for characters, heightfields, and vehicles
all default to +Y,
and the direction of gravity defaults to -Y.</p>
</div>
<div class="paragraph">
<p>Masses are nominally in kilograms.</p>
</div>
<div class="paragraph">
<p>Locations relative to a shape&#8217;s origin and subject to its rotation
are quantified using <em>local coordinates</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discrete_time_and_collision_detection"><a class="anchor" href="#_discrete_time_and_collision_detection"></a>Discrete time and collision detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Physics simulation occurs in discrete steps of short duration.</p>
</div>
<div class="paragraph">
<p>For fast-moving rigid bodies,
Jolt JNI offers optional continuous collision detection (CCD)
using linear casting.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_direct_buffers_garbage_collection_and_threading"><a class="anchor" href="#_direct_buffers_garbage_collection_and_threading"></a>Direct buffers, garbage collection, and threading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Direct buffers used in Jolt JNI should have native byte order.</p>
</div>
<div class="paragraph">
<p>All other native objects created by Jolt JNI are carefully tracked using
weak references.
Invocation of the <code>JoltPhysicsObject.startCleaner()</code> method
starts a daemon thread.
The thread&#8217;s purpose is to free any native objects
owned by Java objects that have been garbage collected.</p>
</div>
<div class="paragraph">
<p>Multi-threaded simulation is built into Jolt JNI.
The number of worker threads is configured into a <code>JobSystem</code>
that&#8217;s typically created during initialization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more detail about how Jolt Physics works, refer to
<a href="https://jrouwe.github.io/JoltPhysics">the Jolt-Physics website</a>.</p>
</div>
<div class="paragraph">
<p>To gain hands-on experience,
proceed to <a href="add.html" class="xref page">the first tutorial page</a>.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Page contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright &copy; 2020&ndash;2025 by Stephen Gold</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
