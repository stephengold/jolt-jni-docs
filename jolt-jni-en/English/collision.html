<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Managing collisions :: The Jolt-JNI project</title>
    <link rel="canonical" href="https://stephengold.github.io/jolt-jni/jolt-jni-en/English/collision.html">
    <link rel="prev" href="vehicle.html">
    <link rel="next" href="softbody.html">
    <meta name="generator" content="Antora 3.1.13">
    <link rel="stylesheet" href="../../_/css/site.css">
<meta property="og:image" content="../../_/img/iconx128.png">
<meta property="og:description" content="Managing collisions">
<meta property="og:title" content="The Jolt-JNI project">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stephengold.github.io/jolt-jni">
        <img alt="" src="../../_/img/iconx128.png" width="32" type="image/x-icon" style="margin-right:16px">
        The Jolt-JNI project
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Color themes</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" onclick="setTheme('canyon')">Canyon</a>
            <a class="navbar-item" onclick="setTheme('dark')">Dark</a>
            <a class="navbar-item" onclick="setTheme('jungle')">Jungle</a>
            <a class="navbar-item" onclick="setTheme('light')">Light</a>
            <a class="navbar-item" onclick="setTheme('pastel')">Pastel</a>
            <a class="navbar-item" onclick="setTheme('phosphor')">Phosphor<a>
            <a class="navbar-item" style="padding-top: 5px;padding-left: 1px;padding-right: 1px;"></button>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jolt-jni-en" data-version="English">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="overview.html">Project links</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="implementation.html">Implementation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Library tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="add.html">Add to existing project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sport.html">Sport-Jolt visualization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rigidbody.html">Rigid bodies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="free.html">Freeing memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="debug.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="shape.html">Collision shapes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="constraint.html">Constraints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="character.html">Characters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="vehicle.html">Vehicles</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="collision.html">Managing collisions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="softbody.html">Soft bodies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serialization.html">Serialization</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="build.html">Build procedures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="demos.html">Demo apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="lexicon.html">Type lexicon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni">GitHub repository</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/releases/latest">Latest release</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/releases">Recent releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/README.md">ReadMe file</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/CONTRIBUTING.md">Contributor guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/LICENSE">License</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/blob/master/release-log.md">Release log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/commits/master">Recent commits</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/issues">Issue tracker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni/issues/new">Report an issue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Library APIs (javadoc)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://stephengold.github.io/jolt-jni-docs/javadoc/latest/com.github.stephengold.joltjni/com/github/stephengold/joltjni/package-summary.html">latest release</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jolt JNI at other sites</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://repo1.maven.org/maven2/com/github/stephengold">Maven Central download</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://central.sonatype.com/search?q=jolt-jni&amp;namespace=com.github.stephengold">Maven Central search</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://jitpack.io/#stephengold/jolt-jni">JitPack (unofficial)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Projects using Jolt JNI</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/jolt-jni-docs">jolt-jni-docs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/sport-jolt">Sport-Jolt</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/kk-physics">KK Physics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/xI-Mx-Ix/Velthoric">Velthoric</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other related projects</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://jrouwe.github.io/JoltPhysics">Jolt Physics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://stephengold.github.io/Libbulletjme">Libbulletjme</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/kmammou/v-hacd">V-HACD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/stephengold/antora-ui-bundle">Website UI bundle</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">People</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://stephengold.github.io">Stephen Gold</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Jolt-JNI project</span>
    <span class="version">English</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Jolt-JNI project</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="overview.html">English</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle-label">Project links</span>
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="overview.html">The Jolt-JNI project</a></li>
    <li>Library tutorials</li>
    <li><a href="collision.html">Managing collisions</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stephengold/jolt-jni-docs/edit/master/docs/en/modules/ROOT/pages/collision.adoc">Edit this page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Managing collisions</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>During each simulation step, Jolt Physics performs collision detection in 2 phases:
broadphase and narrowphase.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Broadphase</em> enumerates pairs of objects in close proximity,
based on overlaps between their axis-aligned bounding boxes (AABBs).</p>
</li>
<li>
<p><em>Narrowphase</em> uses detailed collision shapes
to test each pair found during broadphase,
resulting in a list of <em>manifolds</em> where the shapes intersect.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each manifold is composed of up to 64 <em>contact points</em>.
Jolt&#8217;s rigid-body dynamics
uses manifolds and contact points to implement contact response,
including friction and restitution.</p>
</div>
<div class="paragraph">
<p>Jolt JNI provides mechanisms to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>customize which collisions are handled and which are ignored</p>
</li>
<li>
<p>perform custom actions when a contact point is created or destroyed</p>
</li>
<li>
<p>query the broadphase detector to find bodies in a particular region</p>
</li>
<li>
<p>query the narrowphase detector to find bodies in a particular region</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collision_groups"><a class="anchor" href="#_collision_groups"></a>Collision groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve seen how layers can be used
to prevent static bodies from colliding with one another.
For finer control over which bodies are allowed to collide,
you can configure collision groups and filters.</p>
</div>
<div class="paragraph">
<p>A <em>collision group</em> consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a group ID,</p>
</li>
<li>
<p>a subgroup ID, and</p>
</li>
<li>
<p>an optional <em>group filter</em>,
which takes 2 collision groups and decides whether collisions are allowed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every body has a collision group.
By default, bodies are created with invalid IDs and no filter.</p>
</div>
<div class="paragraph">
<p>Two bodies are allowed to collide only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>neither body has a filter,</p>
</li>
<li>
<p>the first body&#8217;s filter says the bodies can collide, or</p>
</li>
<li>
<p>if the first body has no filter
and the 2nd body&#8217;s filter says they can collide.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The typical use case is a chain of bodies,
all of which are allowed to collide except those adjacent in the chain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GroupFilterTable filter = new GroupFilterTable(chainLength);
for (int subGroupId = 0; subGroupId &lt; chainLength - 1; ++subGroupId)
        filter.disableCollision(subGroupId, subGroupId + 1);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contact_listener"><a class="anchor" href="#_contact_listener"></a>Contact listener</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During simulation, contact points can be tracked
by means of a listener object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">physicsSystem.setContactListener(contactListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <em>sensor</em> is a body without contact response,
created solely to report contacts with nearby bodies.
In order to work, a sensor must be added to a physics system.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/stephengold/jolt-jni-docs/blob/master/java-apps/src/main/java/com/github/stephengold/sportjolt/javaapp/sample/HelloSensor.java"><code>HelloSensor</code></a> is a Sport-Jolt app
that illustrates how a contact listener and a sensor could be used
to detect the first moving body entering a spherical zone.</p>
</div>
<div class="paragraph">
<p>Things notice while running the app:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The character includes a body with capsule shape.</p>
</li>
<li>
<p>Press <kbd>Right arrow</kbd> to walk the character toward the sensor.</p>
</li>
<li>
<p>Immediately after the character&#8217;s body comes in contact with the sensor,
the app removes the sensor from the system,
producing the effect of popping a bubble.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is, of course, no reason a sensor has to be visible.</p>
</div>
<div class="paragraph">
<p>A contact listener can also be used to customize collision handling,
by overloading its <code>onContactValidate()</code> method.
This isn&#8217;t the most efficient way to filter collisions;
in most cases it would be better to use layers or collision groups.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_broadphase_queries"><a class="anchor" href="#_broadphase_queries"></a>Broadphase queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you simply want to find bodies in a particular region,
creating sensors and tracking contact points is unnecessarily complicated.</p>
</div>
<div class="paragraph">
<p>Instead, you can directly query the system&#8217;s broadphase data
to enumerate bodies whose bounding boxes intersect with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a non-moving point,</p>
</li>
<li>
<p>a point moving along a straight line,</p>
</li>
<li>
<p>a non-moving axis-aligned box,</p>
</li>
<li>
<p>an axis-aligned box moving along a straight line,</p>
</li>
<li>
<p>a non-moving sphere, or</p>
</li>
<li>
<p>a non-moving box with arbitrary orientation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, a body&#8217;s bounding box is larger than its collision shape,
so broadphase queries are not very precise.
They are efficient, however,
and their precision is adequate for many purposes.</p>
</div>
<div class="paragraph">
<p>Broadphase queries are usually performed <strong>between</strong> simulation steps.
The system&#8217;s <code>BroadPhaseQuery</code> interface is used,
along with an appropriate collector object, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BroadPhaseQuery query = physicsSystem.getBroadPhaseQuery();
AllHitCollideShapeBodyCollector collector
        = new AllHitCollideShapeBodyCollector();
query.collideAaBox(aaBox, collector);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Filters can be specified to limit query results to specific layers.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/stephengold/jolt-jni-docs/blob/master/java-apps/src/main/java/com/github/stephengold/sportjolt/javaapp/sample/HelloBroadPhase.java"><code>HelloBroadPhase</code></a> is a Sport-Jolt app
that illustrates how broadphase queries can be used
to detect characters entering/leaving a box-shaped zone.</p>
</div>
<div class="paragraph">
<p>Things notice while running the app:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The ghost zone is shown in yellow.</p>
</li>
<li>
<p>To clarify what&#8217;s going on, the character&#8217;s bounding box is outlined in white.</p>
</li>
<li>
<p>Press <kbd>Right arrow</kbd> to walk the character toward the ghost.</p>
</li>
<li>
<p>As soon as the character&#8217;s box overlaps the ghost, the ghost turns red,
indicating an intrusion,
even though their collision shapes haven&#8217;t intersected yet.</p>
</li>
<li>
<p>Press <kbd>Space bar</kbd> to jump.</p>
</li>
<li>
<p>The character can jump high enough to leave the ghost zone,
at which time the ghost will momentarily turn yellow again.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_narrowphase_queries"><a class="anchor" href="#_narrowphase_queries"></a>Narrowphase queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more precise detections,
you can query a system&#8217;s narrowphase data between simulation steps.</p>
</div>
<div class="paragraph">
<p>Narrowphase queries can enumerate bodies whose shapes intersect with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a non-moving point,</p>
</li>
<li>
<p>a point moving along a straight line,</p>
</li>
<li>
<p>a non-moving axis-aligned box,</p>
</li>
<li>
<p>a non-moving shape, or</p>
</li>
<li>
<p>a shape moving along a straight line.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Like broadphase queries,
narrowphase queries are best performed <strong>between</strong> simulation steps.
The system&#8217;s <code>NarrowPhaseQuery</code> interface is used,
along with an appropriate collector object, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">NarrowPhaseQuery query = physicsSystem.getNarrowPhaseQuery();
Vec3Arg scale = Vec3.sOne();
CollideShapeSettings settings = new CollideShapeSettings();
AllHitCollideShapeCollector collector = new AllHitCollideShapeCollector();
query.collideShape(shape, scale, transform, settings, base, collector);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/stephengold/jolt-jni-docs/blob/master/java-apps/src/main/java/com/github/stephengold/sportjolt/javaapp/sample/HelloNarrowphase.java"><code>HelloNarrowphase</code></a> is a Sport-Jolt app
that illustrates how narrowphase queries can be used
to detect characters entering/leaving an octahedral zone.</p>
</div>
<div class="paragraph">
<p>Things notice while running the app:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Press <kbd>Right arrow</kbd> to walk the character toward the ghost zone.</p>
</li>
<li>
<p>As soon as the character&#8217;s shape intersects with the ghost&#8217;s shape,
the ghost turns red, indicating an intrusion.</p>
</li>
<li>
<p>Press <kbd>Space bar</kbd> to jump.</p>
</li>
<li>
<p>The character can jump high enough to leave the ghost zone,
at which time the ghost will momentarily turn yellow again.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Collision groups offer fine control over which bodies are allowed to collide.</p>
</li>
<li>
<p>To track individual contacts in real time, use a contact listener.</p>
</li>
<li>
<p>To search a region for bodies, use a broadphase query or a narrowphase query.</p>
</li>
<li>
<p>Narrowphase queries are more precise, but also more expensive.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="vehicle.html">Vehicles</a></span>
  <span class="next"><a href="softbody.html">Soft bodies</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Page contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright &copy; 2020&ndash;2025 by Stephen Gold</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
